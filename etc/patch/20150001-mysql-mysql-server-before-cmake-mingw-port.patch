diff -upr -x '*.bak' -x github-rc.orig -x '*.*.orig' -x '*.rej' -x '*.*.rej' -x default.release -x default.release.done -x libseh -x source_downloads github-rc.orig/CMakeLists.txt github-rc/CMakeLists.txt
--- github-rc.orig/CMakeLists.txt	2015-04-09 18:35:31.000000000 +0800
+++ github-rc/CMakeLists.txt	2015-05-29 23:43:49.957720300 +0800
@@ -494,7 +494,7 @@ OPTION(MYSQL_MAINTAINER_MODE
 
 INCLUDE(maintainer)
 
-IF(WITH_UNIT_TESTS)
+IF(0)
  ENABLE_TESTING()
 ENDIF()
 
@@ -519,7 +519,7 @@ ADD_SUBDIRECTORY(libmysql)
 ADD_SUBDIRECTORY(libbinlogevents)
 ADD_SUBDIRECTORY(libbinlogstandalone)
 
-IF(WITH_UNIT_TESTS)
+IF(0)
   ADD_SUBDIRECTORY(unittest)
   ADD_SUBDIRECTORY(unittest/examples)
   ADD_SUBDIRECTORY(unittest/mytap)
diff -upr -x '*.bak' -x github-rc.orig -x '*.*.orig' -x '*.rej' -x '*.*.rej' -x default.release -x default.release.done -x libseh -x source_downloads github-rc.orig/include/my_global.h github-rc/include/my_global.h
--- github-rc.orig/include/my_global.h	2015-04-09 18:35:31.000000000 +0800
+++ github-rc/include/my_global.h	2015-05-30 12:08:18.015719100 +0800
@@ -338,7 +338,7 @@ typedef socket_len_t SOCKET_SIZE_TYPE; /
 
 /* Some defines of functions for portability */
 
-#if (_WIN32)
+#if (_MSC_VER)
 #if !defined(_WIN64)
 inline double my_ulonglong2double(unsigned long long value)
 {
@@ -638,7 +638,7 @@ enum loglevel {
 /****************************************************************************
 ** Replacements for localtime_r and gmtime_r
 ****************************************************************************/
-
+#if !defined(__MINGW32__)
 static inline struct tm *localtime_r(const time_t *timep, struct tm *tmp)
 {
   localtime_s(tmp, timep);
@@ -650,7 +650,7 @@ static inline struct tm *gmtime_r(const
   gmtime_s(res, clock);
   return res;
 }
-
+#endif
 
 /*
   Declare a union to make sure FILETIME is properly aligned
diff -upr -x '*.bak' -x github-rc.orig -x '*.*.orig' -x '*.rej' -x '*.*.rej' -x default.release -x default.release.done -x libseh -x source_downloads github-rc.orig/libbinlogevents/src/binary_log_funcs.cpp github-rc/libbinlogevents/src/binary_log_funcs.cpp
--- github-rc.orig/libbinlogevents/src/binary_log_funcs.cpp	2015-04-09 18:35:31.000000000 +0800
+++ github-rc/libbinlogevents/src/binary_log_funcs.cpp	2015-05-30 11:49:27.381050500 +0800
@@ -13,6 +13,12 @@
    along with this program; if not, write to the Free Software
    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301  USA */
 
+#if defined(__MINGW32__)
+#undef __STRICT_ANSI__
+# include <winsock2.h>
+#define __STRICT_ANSI__ 1
+#endif
+
 #include "binary_log_funcs.h"
 
 #include "byteorder.h"
diff -upr -x '*.bak' -x github-rc.orig -x '*.*.orig' -x '*.rej' -x '*.*.rej' -x default.release -x default.release.done -x libseh -x source_downloads github-rc.orig/libbinlogevents/src/binlog_event.cpp github-rc/libbinlogevents/src/binlog_event.cpp
--- github-rc.orig/libbinlogevents/src/binlog_event.cpp	2015-04-09 18:35:31.000000000 +0800
+++ github-rc/libbinlogevents/src/binlog_event.cpp	2015-05-30 11:47:25.354071000 +0800
@@ -13,6 +13,12 @@
    along with this program; if not, write to the Free Software
    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301  USA */
 
+#if defined(__MINGW32__)
+#undef __STRICT_ANSI__
+# include <winsock2.h>
+#define __STRICT_ANSI__ 1
+#endif
+
 #include "binary_log_types.h"
 
 #include "statement_events.h"
diff -upr -x '*.bak' -x github-rc.orig -x '*.*.orig' -x '*.rej' -x '*.*.rej' -x default.release -x default.release.done -x libseh -x source_downloads github-rc.orig/libbinlogevents/src/control_events.cpp github-rc/libbinlogevents/src/control_events.cpp
--- github-rc.orig/libbinlogevents/src/control_events.cpp	2015-04-09 18:35:31.000000000 +0800
+++ github-rc/libbinlogevents/src/control_events.cpp	2015-05-30 11:28:00.475443700 +0800
@@ -13,6 +13,12 @@
    along with this program; if not, write to the Free Software
    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301  USA */
 
+#if defined(__MINGW32__)
+#undef __STRICT_ANSI__
+# include <winsock2.h>
+#define __STRICT_ANSI__ 1
+#endif
+
 #include "binary_log_types.h"
 
 #include "statement_events.h"
diff -upr -x '*.bak' -x github-rc.orig -x '*.*.orig' -x '*.rej' -x '*.*.rej' -x default.release -x default.release.done -x libseh -x source_downloads github-rc.orig/libbinlogevents/src/load_data_events.cpp github-rc/libbinlogevents/src/load_data_events.cpp
--- github-rc.orig/libbinlogevents/src/load_data_events.cpp	2015-04-09 18:35:31.000000000 +0800
+++ github-rc/libbinlogevents/src/load_data_events.cpp	2015-05-30 11:47:04.247863800 +0800
@@ -13,6 +13,12 @@
    along with this program; if not, write to the Free Software
    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301  USA */
 
+#if defined(__MINGW32__)
+#undef __STRICT_ANSI__
+# include <winsock2.h>
+#define __STRICT_ANSI__ 1
+#endif
+
 #include "load_data_events.h"
 #include <stdlib.h>
 #include <string.h>
diff -upr -x '*.bak' -x github-rc.orig -x '*.*.orig' -x '*.rej' -x '*.*.rej' -x default.release -x default.release.done -x libseh -x source_downloads github-rc.orig/libbinlogevents/src/rows_event.cpp github-rc/libbinlogevents/src/rows_event.cpp
--- github-rc.orig/libbinlogevents/src/rows_event.cpp	2015-04-09 18:35:31.000000000 +0800
+++ github-rc/libbinlogevents/src/rows_event.cpp	2015-05-30 11:47:16.382557800 +0800
@@ -13,6 +13,12 @@
    along with this program; if not, write to the Free Software
    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301  USA */
 
+#if defined(__MINGW32__)
+#undef __STRICT_ANSI__
+# include <winsock2.h>
+#define __STRICT_ANSI__ 1
+#endif
+
 #include "rows_event.h"
 #include <stdlib.h>
 #include <cstring>
diff -upr -x '*.bak' -x github-rc.orig -x '*.*.orig' -x '*.rej' -x '*.*.rej' -x default.release -x default.release.done -x libseh -x source_downloads github-rc.orig/libbinlogevents/src/statement_events.cpp github-rc/libbinlogevents/src/statement_events.cpp
--- github-rc.orig/libbinlogevents/src/statement_events.cpp	2015-04-09 18:35:31.000000000 +0800
+++ github-rc/libbinlogevents/src/statement_events.cpp	2015-05-30 02:46:16.030135200 +0800
@@ -13,6 +13,11 @@
    along with this program; if not, write to the Free Software
    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301  USA */
 
+#if defined(__MINGW32__)
+#undef __STRICT_ANSI__
+# include <winsock2.h>
+#define __STRICT_ANSI__ 1
+#endif
 #include "statement_events.h"
 #include <algorithm>
 #include <string>
diff -upr -x '*.bak' -x github-rc.orig -x '*.*.orig' -x '*.rej' -x '*.*.rej' -x default.release -x default.release.done -x libseh -x source_downloads github-rc.orig/libbinlogevents/src/uuid.cpp github-rc/libbinlogevents/src/uuid.cpp
--- github-rc.orig/libbinlogevents/src/uuid.cpp	2015-04-09 18:35:31.000000000 +0800
+++ github-rc/libbinlogevents/src/uuid.cpp	2015-05-30 11:51:35.308367500 +0800
@@ -15,6 +15,12 @@
    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
    02110-1301 USA */
 
+#if defined(__MINGW32__)
+#undef __STRICT_ANSI__
+# include <winsock2.h>
+#define __STRICT_ANSI__ 1
+#endif
+
 #include "control_events.h"
 
 
diff -upr -x '*.bak' -x github-rc.orig -x '*.*.orig' -x '*.rej' -x '*.*.rej' -x default.release -x default.release.done -x libseh -x source_downloads github-rc.orig/libmysql/authentication_win/handshake.h github-rc/libmysql/authentication_win/handshake.h
--- github-rc.orig/libmysql/authentication_win/handshake.h	2015-04-09 18:35:31.000000000 +0800
+++ github-rc/libmysql/authentication_win/handshake.h	2015-05-30 02:18:51.083709900 +0800
@@ -100,7 +100,7 @@ public:
   Handshake(const char *ssp, side_t side);
   virtual ~Handshake();
 
-  int Handshake::packet_processing_loop();
+  int packet_processing_loop();
 
   bool virtual is_complete() const
   {
diff -upr -x '*.bak' -x github-rc.orig -x '*.*.orig' -x '*.rej' -x '*.*.rej' -x default.release -x default.release.done -x libseh -x source_downloads github-rc.orig/mysys/CMakeLists.txt github-rc/mysys/CMakeLists.txt
--- github-rc.orig/mysys/CMakeLists.txt	2015-04-09 18:35:31.000000000 +0800
+++ github-rc/mysys/CMakeLists.txt	2015-05-29 22:11:37.763305500 +0800
@@ -13,7 +13,7 @@
 # along with this program; if not, write to the Free Software
 # Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA
 
-INCLUDE_DIRECTORIES(${ZLIB_INCLUDE_DIR} ${CMAKE_SOURCE_DIR}/include ${CMAKE_SOURCE_DIR}/mysys)
+INCLUDE_DIRECTORIES(${ZLIB_INCLUDE_DIR} ${CMAKE_SOURCE_DIR}/include ${CMAKE_SOURCE_DIR}/libseh ${CMAKE_SOURCE_DIR}/mysys)
 
 SET(MYSYS_SOURCES  array.c charset-def.c charset.c checksum.c
 				errors.c hash.c list.c mf_cache.c mf_dirname.c mf_fn_ext.c
diff -upr -x '*.bak' -x github-rc.orig -x '*.*.orig' -x '*.rej' -x '*.*.rej' -x default.release -x default.release.done -x libseh -x source_downloads github-rc.orig/mysys/my_gethwaddr.c github-rc/mysys/my_gethwaddr.c
--- github-rc.orig/mysys/my_gethwaddr.c	2015-04-09 18:35:31.000000000 +0800
+++ github-rc/mysys/my_gethwaddr.c	2015-05-29 21:48:16.859468200 +0800
@@ -138,6 +138,7 @@ my_bool my_gethwaddr(uchar *to)
 #define VOID void
 #endif
 
+#include <WinCrypt.h>
 #include <iphlpapi.h>
 
 /*
diff -upr -x '*.bak' -x github-rc.orig -x '*.*.orig' -x '*.rej' -x '*.*.rej' -x default.release -x default.release.done -x libseh -x source_downloads github-rc.orig/mysys/my_thr_init.c github-rc/mysys/my_thr_init.c
--- github-rc.orig/mysys/my_thr_init.c	2015-04-09 18:35:31.000000000 +0800
+++ github-rc/mysys/my_thr_init.c	2015-05-29 21:52:31.926990800 +0800
@@ -43,7 +43,7 @@ native_mutexattr_t my_fast_mutexattr;
 #ifdef PTHREAD_ERRORCHECK_MUTEX_INITIALIZER_NP
 native_mutexattr_t my_errorcheck_mutexattr;
 #endif
-#ifdef _WIN32
+#ifdef _MSC_VER
 static void install_sigabrt_handler();
 #endif
 
@@ -247,7 +247,7 @@ my_bool my_thread_init()
   if (mysys_thread_var())
     return FALSE;
 
-#ifdef _WIN32
+#ifdef _MSC_VER
   install_sigabrt_handler();
 #endif
 
diff -upr -x '*.bak' -x github-rc.orig -x '*.*.orig' -x '*.rej' -x '*.*.rej' -x default.release -x default.release.done -x libseh -x source_downloads github-rc.orig/mysys/stacktrace.c github-rc/mysys/stacktrace.c
--- github-rc.orig/mysys/stacktrace.c	2015-04-09 18:35:31.000000000 +0800
+++ github-rc/mysys/stacktrace.c	2015-05-29 23:36:55.257000700 +0800
@@ -14,6 +14,7 @@
    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301  USA */
 
 #include "my_stacktrace.h"
+#include <seh.h>
 
 #ifndef _WIN32
 #include "my_thread.h"
@@ -546,18 +547,25 @@ void my_create_minidump(const char *name
   }
 }
 
+int ExceptionFilter(unsigned int code, unsigned int excToFilter)
+{
+	if(code == excToFilter) return EXCEPTION_EXECUTE_HANDLER;
+	else return EXCEPTION_CONTINUE_SEARCH;
+}
 
 void my_safe_puts_stderr(const char *val, size_t len)
 {
-  __try
+  __seh_try   /* __try becomes __seh_try */
   {
     my_write_stderr(val, len);
     my_safe_printf_stderr("%s", "\n");
   }
-  __except(EXCEPTION_EXECUTE_HANDLER)
+  __seh_except(ExceptionFilter(GetExceptionCode(),   /* __except becomes __seh_except */
+		 EXCEPTION_INT_DIVIDE_BY_ZERO)) 
   {
     my_safe_printf_stderr("%s", "is an invalid string pointer\n");
   }
+  __seh_end_except   /* This must terminate all __seh_except blocks */ 
 }
 #endif /* _WIN32 */
 
diff -upr -x '*.bak' -x github-rc.orig -x '*.*.orig' -x '*.rej' -x '*.*.rej' -x default.release -x default.release.done -x libseh -x source_downloads github-rc.orig/storage/innobase/os/os0thread.cc github-rc/storage/innobase/os/os0thread.cc
--- github-rc.orig/storage/innobase/os/os0thread.cc	2015-04-09 18:35:31.000000000 +0800
+++ github-rc/storage/innobase/os/os0thread.cc	2015-05-30 02:03:54.264414800 +0800
@@ -217,8 +217,11 @@ os_thread_exit(
 	ut_a(ret == 1);
 
 	mutex_exit(&thread_mutex);
-
-	ExitThread((DWORD) exit_value);
+#ifdef _WIN64
+  ExitThread((DWORD) (__int64)exit_value);
+#else
+  ExitThread((DWORD) exit_value);
+#endif
 #else
 	mutex_exit(&thread_mutex);
 	pthread_detach(pthread_self());
